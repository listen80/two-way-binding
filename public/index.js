const t=["checkbox","radio","select","file"],e=["text","password","email","tel","url","number","range","date","datetime-local","month","week","time","color","search","image","textarea","select-multiple","select-one","select"],n={model(n,o,s){e.includes(n.type)?n.addEventListener("input",t=>{o[s]=t.target.value}):t.includes(n.type)?n.addEventListener("change",t=>{o[s]=t.target.attributes.value.value}):console.warn(`Unsupported input type: ${n.type}`)},if(t,e,n){t.parentNode.__if__=t},for(t,e,n){for(let e=0;e<Number(n);e++)t.parentNode.appendChild(t.cloneNode(!0))}};class o{constructor(){this.subs=[]}addSub(t){this.subs.push(t)}notify(){this.subs.forEach(t=>t.update())}}o.target=null;class s{constructor(t,e,n){this.vm=t,this.expOrFn=e,this.cb=n,this.value=this.get()}get(){o.target=this;const t=this.vm[this.expOrFn];return o.target=null,t}update(){console.log("update",this);const t=this.value;this.value=this.vm[this.expOrFn],this.cb.call(this.vm,this.value,t)}}function r(t,e,n,o,r){const i=c[`${o}`];i&&(i(t,e[n],r),new s(e,n,(e,n)=>{console.log("更新了",n),i(t,e,r)}))}const c={attribute(t,e,n){t.setAttribute(n,e||"")},text(t,e){t.textContent=e},model(t,e){t.value=e},if(t,e){e?t.parentNode.replaceChild(t.parentNode.__if__,t):t.remove()},show(t,e){t.style.display=e?"block":"none"}};function i(t,e,o,s){const c=t.childNodes;Array.from(c).forEach(t=>{if(1===t.nodeType)if(t.tagName.includes("-")){const e=document.createComment("");t.replaceWith(e);try{const n=t.tagName.toLowerCase();new d({component:s[n],el:e})}catch(t){console.log(t)}}else!function(t,e,o){const s=t.attributes;Array.from(s).forEach(s=>{const c=s.name,i=s.value,a=c.substring(1);!function(t){return 0===t.indexOf("$")}(c)?function(t){return 0===t.indexOf(":")}(c)?r(t,e,i,"attribute",a):function(t){return 0===t.indexOf("@")}(c)&&function(t,e,n,o,s){const r=s[n];r&&o&&t.addEventListener(o,r.bind(e))}(t,e,i,a,o):(((t,e,o,s)=>{n[s]?.(t,e,o)})(t,e,i,a),r(t,e,i,a))})}(t,e,o);else 3===t.nodeType&&function(t,e){const n=/\{\{(.*)\}\}/,o=t.textContent;if(n.test(o)){r(t,e,RegExp.$1.trim(),"text")}}(t,e);t.childNodes&&t.childNodes.length&&i(t,e,o,s)})}const a=new DOMParser;function l(t){t&&"object"==typeof t&&Object.keys(t).forEach(e=>{!function(t,e,n){const s=new o;l(n),Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:()=>(o.target&&s.addSub(o.target),n),set(t){t!==n&&(n=t,s.notify())}})}(t,e,t[e])})}function u(t){const e=function(t){const e=new XMLHttpRequest;if(e.open("GET",t,!1),e.send(null),200===e.status)return e.responseText;throw new Error(`请求失败，状态码: ${e.status}`)}(t);return(t=>{const e=a.parseFromString(`<body>${t}</body>`,"text/html").querySelector("body");return{template:e.querySelector("template")?.content,script:e.querySelector("script"),style:e.querySelector("style")}})(e)}class d{constructor({component:t,el:e,props:n={}}){if(!t)throw new Error("component is required");"string"==typeof t&&(t=u(t));const{script:o,template:s,style:r}=t,c=o.textContent,a=new Blob([c],{type:"text/javascript"}),d=URL.createObjectURL(a);import(d).then(t=>{document.body.append(r);const o=t.default.data||{},c=t.default.methods||{},a=t.default.components||{};Object.assign(this,n,o),l(this),function(t,e,n,o){i(t,e,n,o)}(s,this,c,a),e.replaceWith(s)}).catch(t=>{console.error("加载模块失败",t)})}}export{d as default};
//# sourceMappingURL=index.js.map
